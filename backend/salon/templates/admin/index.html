{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrahead %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}

.responsive-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.admin-card {
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
}

.admin-card:hover {
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  transform: translateY(-2px);
}

.admin-card.accent {
  background: linear-gradient(135deg, #B89F67 0%, #D4AF37 100%);
  color: white;
}

.stat-title {
  font-size: 0.875rem;
  font-weight: 500;
  color: #6b7280;
  margin-bottom: 0.25rem;
}

.stat-value {
  font-size: 2rem;
  font-weight: 700;
  color: #1f2937;
  line-height: 1;
}

.stat-note {
  font-size: 0.75rem;
  color: #9ca3af;
  margin-top: 0.5rem;
}

.admin-chip {
  display: inline-block;
  padding: 0.25rem 0.75rem;
  background-color: #f3f4f6;
  color: #374151;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 500;
  text-decoration: none;
  transition: all 0.2s ease;
}

.admin-chip:hover {
  background-color: #e5e7eb;
  transform: translateY(-1px);
}

.table-head-bg {
  background-color: #B89F67;
  color: white;
}

.table-row-alt {
  background-color: #f9fafb;
}

.hover\:shadow-glam:hover {
  box-shadow: 0 8px 25px rgba(184, 159, 103, 0.3);
}

.space-y-6 > * + * {
  margin-top: 1.5rem;
}

.space-y-3 > * + * {
  margin-top: 0.75rem;
}

.space-y-2 > * + * {
  margin-top: 0.5rem;
}

.gap-2 {
  gap: 0.5rem;
}

.gap-3 {
  gap: 0.75rem;
}

.gap-6 {
  gap: 1.5rem;
}

.mb-3 {
  margin-bottom: 0.75rem;
}

.mb-4 {
  margin-bottom: 1rem;
}

.mb-6 {
  margin-bottom: 1.5rem;
}

.mt-1 {
  margin-top: 0.25rem;
}

.mt-2 {
  margin-top: 0.5rem;
}

.mt-3 {
  margin-top: 0.75rem;
}

.mt-4 {
  margin-top: 1rem;
}

.p-3 {
  padding: 0.75rem;
}

.p-4 {
  padding: 1rem;
}

.p-5 {
  padding: 1.25rem;
}

.rounded-lg {
  border-radius: 0.5rem;
}

.rounded-xl {
  border-radius: 0.75rem;
}

.text-xs {
  font-size: 0.75rem;
  line-height: 1rem;
}

.text-sm {
  font-size: 0.875rem;
  line-height: 1.25rem;
}

.text-lg {
  font-size: 1.125rem;
  line-height: 1.75rem;
}

.font-medium {
  font-weight: 500;
}

.font-bold {
  font-weight: 700;
}

.font-extrabold {
  font-weight: 800;
}

.uppercase {
  text-transform: uppercase;
}

.text-center {
  text-align: center;
}

.text-right {
  text-align: right;
}

.flex {
  display: flex;
}

.flex-col {
  flex-direction: column;
}

.flex-wrap {
  flex-wrap: wrap;
}

.items-center {
  align-items: center;
}

.justify-between {
  justify-content: space-between;
}

.justify-center {
  justify-content: center;
}

.grid {
  display: grid;
}

.grid-cols-1 {
  grid-template-columns: repeat(1, minmax(0, 1fr));
}

.grid-cols-7 {
  grid-template-columns: repeat(7, minmax(0, 1fr));
}

.grid-cols-1.xl\:grid-cols-2 {
  grid-template-columns: repeat(1, minmax(0, 1fr));
}

.grid-cols-1.xl\:grid-cols-3 {
  grid-template-columns: repeat(1, minmax(0, 1fr));
}

@media (min-width: 1280px) {
  .xl\:grid-cols-2 {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
  
  .xl\:grid-cols-3 {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
  
  .xl\:col-span-2 {
    grid-column: span 2 / span 2;
  }
}

.w-8 {
  width: 2rem;
}

.h-8 {
  height: 2rem;
}

.w-full {
  width: 100%;
}

.h-16 {
  height: 4rem;
}

.bg-gray-50 {
  background-color: #f9fafb;
}

.bg-gray-100 {
  background-color: #f3f4f6;
}

.bg-yellow-200 {
  background-color: #fef3c7;
}

.bg-orange-300 {
  background-color: #fdba74;
}

.bg-red-400 {
  background-color: #f87171;
}

.bg-primary-600 {
  background-color: #B89F67;
}

.text-gray-400 {
  color: #9ca3af;
}

.text-gray-500 {
  color: #6b7280;
}

.text-gray-800 {
  color: #1f2937;
}

.text-yellow-800 {
  color: #92400e;
}

.text-orange-800 {
  color: #9a3412;
}

.text-red-800 {
  color: #991b1b;
}

.text-white {
  color: white;
}

.text-primary-700 {
  color: #B89F67;
}

.text-primary-700\/70 {
  color: rgba(184, 159, 103, 0.7);
}

.hover\:text-primary-500:hover {
  color: #D4AF37;
}

.transition {
  transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  transition-duration: 150ms;
}

.opacity-70 {
  opacity: 0.7;
}

.opacity-85 {
  opacity: 0.85;
}

.opacity-90 {
  opacity: 0.9;
}

.relative {
  position: relative;
}

.absolute {
  position: absolute;
}

.-start-6 {
  left: -1.5rem;
}

.top-2 {
  top: 0.5rem;
}

.ps-6 {
  padding-left: 1.5rem;
}

.min-w-full {
  min-width: 100%;
}

.table-responsive {
  overflow-x: auto;
}

.sticky {
  position: sticky;
}

.border-b {
  border-bottom-width: 1px;
}

.border-collapse {
  border-collapse: collapse;
}

.even\:table-row-alt:nth-child(even) {
  background-color: #f9fafb;
}

.hover\:opacity-95:hover {
  opacity: 0.95;
}

.text-start {
  text-align: start;
}

.material-icons {
  font-family: 'Material Icons';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased;
}
</style>
{% endblock %}

{% block content %}
<div class="space-y-6">
  <!-- Operational Alerts -->
  {% if alerts %}
  <div class="mb-6">
    {% for alert in alerts %}
    <div class="admin-card p-4 rounded-xl mb-3" style="border-left: 4px solid {{ alert.color }}; background-color: rgba({{ alert.color|slice:'1:'|add:'0' }}, 0.1);">
      <div class="flex items-center gap-3">
        <span class="material-icons" style="color: {{ alert.color }}">{{ alert.icon }}</span>
        <p class="text-sm font-medium" style="color: {{ alert.color }}">{{ alert.title }}</p>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Main KPIs -->
  <div class="dashboard-grid responsive-grid">
    <div class="admin-card p-5 rounded-xl hover:shadow-glam transition">
      <div class="flex items-center justify-between">
        <div>
          <p class="stat-title text-sm rtl:text-right">{% trans "إجمالي الحجوزات" %}</p>
          <p class="stat-value mt-1">{{ stats.total_bookings|default:0 }}</p>
        </div>
        <div class="opacity-70 text-black"><span class="material-icons" style="color:#000">event_note</span></div>
      </div>
      <p class="stat-note mt-2">{{ stats.bookings_today }} {% trans "اليوم" %}</p>
    </div>

    <div class="admin-card p-5 rounded-xl hover:shadow-glam transition">
      <div class="flex items-center justify-between">
        <div>
          <p class="stat-title text-sm rtl:text-right">{% trans "متوسط قيمة الحجز" %}</p>
          <p class="stat-value mt-1">{{ stats.avg_booking_value|default:"0.00" }} <span class="text-base font-semibold">SAR</span></p>
        </div>
        <div class="opacity-70 text-black"><span class="material-icons" style="color:#000">trending_up</span></div>
      </div>
      <p class="stat-note mt-2">{% trans "متوسط السعر" %}</p>
    </div>

    <div class="admin-card p-5 rounded-xl hover:shadow-glam transition">
      <div class="flex items-center justify-between">
        <div>
          <p class="stat-title text-sm rtl:text-right">{% trans "معدل الإلغاء" %}</p>
          <p class="stat-value mt-1">{{ stats.cancellation_rate|default:"0.0" }}%</p>
        </div>
        <div class="opacity-70 text-black"><span class="material-icons" style="color:#000">cancel</span></div>
      </div>
      <p class="stat-note mt-2">{% trans "نسبة الإلغاءات" %}</p>
    </div>

    <div class="admin-card accent p-5 rounded-xl hover:shadow-glam transition">
      <div class="flex items-center justify-between">
        <div>
          <p class="stat-title text-sm rtl:text-right">{% trans "الإيرادات هذا الأسبوع" %}</p>
          <p class="stat-value mt-1">{{ stats.this_week_revenue|default:"0.00" }} <span class="text-base font-semibold">SAR</span></p>
        </div>
        <div class="opacity-90" style="color:#F8E9D5"><span class="material-icons">payments</span></div>
      </div>
      <p class="stat-note mt-2">
        {% if stats.revenue_change > 0 %}
          <span style="color: #27ae60;">↗ +{{ stats.revenue_change }}%</span>
        {% elif stats.revenue_change < 0 %}
          <span style="color: #e74c3c;">↘ {{ stats.revenue_change }}%</span>
        {% else %}
          <span style="color: #95a5a6;">→ 0%</span>
        {% endif %}
        {% trans "مقارنة بالأسبوع الماضي" %}
      </p>
    </div>
  </div>

  <!-- Secondary KPIs -->
  <div class="dashboard-grid responsive-grid mt-4">
    <div class="admin-card p-5 rounded-xl hover:shadow-glam transition">
      <div class="flex items-center justify-between">
        <div>
          <p class="stat-title text-sm rtl:text-right">{% trans "إجمالي العملاء" %}</p>
          <p class="stat-value mt-1">{{ stats.total_customers|default:0 }}</p>
        </div>
        <div class="opacity-70 text-black"><span class="material-icons" style="color:#000">person</span></div>
      </div>
      <p class="stat-note mt-2">{{ stats.new_customers_7d }} {% trans "آخر 7 أيام" %}</p>
    </div>

    <div class="admin-card p-5 rounded-xl hover:shadow-glam transition">
      <div class="flex items-center justify-between">
        <div>
          <p class="stat-title text-sm rtl:text-right">{% trans "الموظفون النشطون" %}</p>
          <p class="stat-value mt-1">{{ stats.active_staff|default:0 }}</p>
        </div>
        <div class="opacity-70 text-black"><span class="material-icons" style="color:#000">groups</span></div>
      </div>
      <p class="stat-note mt-2">{{ stats.total_staff }} {% trans "إجمالي الموظفين" %}</p>
    </div>

    <div class="admin-card p-5 rounded-xl hover:shadow-glam transition">
      <div class="flex items-center justify-between">
        <div>
          <p class="stat-title text-sm rtl:text-right">{% trans "الحجوزات القادمة" %}</p>
          <p class="stat-value mt-1">{{ stats.upcoming_bookings_1h|default:0 }}</p>
        </div>
        <div class="opacity-70 text-black"><span class="material-icons" style="color:#000">schedule</span></div>
      </div>
      <p class="stat-note mt-2">{% trans "خلال الساعة القادمة" %}</p>
    </div>

    <div class="admin-card p-5 rounded-xl hover:shadow-glam transition">
      <div class="flex items-center justify-between">
        <div>
          <p class="stat-title text-sm rtl:text-right">{% trans "الإيرادات اليوم" %}</p>
          <p class="stat-value mt-1">{{ stats.daily_revenue_today|default:"0.00" }} <span class="text-base font-semibold">SAR</span></p>
        </div>
        <div class="opacity-70 text-black"><span class="material-icons" style="color:#000">today</span></div>
      </div>
      <p class="stat-note mt-2">{% trans "إيرادات اليوم" %}</p>
    </div>
  </div>

  <div class="admin-card p-5 rounded-xl">
    <div class="flex items-center justify-between flex-wrap gap-2">
      <h3 class="text-lg font-extrabold uppercase">{% trans "الاتجاهات" %}</h3>
      <div class="flex items-center gap-2">
        <span class="admin-chip">{% trans "الحجوزات القادمة" %}</span>
        <span class="admin-chip">{% trans "الإيرادات" %}</span>
      </div>
    </div>
    <div class="mt-4" style="height: 300px;">
      <canvas id="dashboardChart"></canvas>
    </div>
  </div>

  <div class="admin-card p-5 rounded-xl">
    <div class="flex items-center justify-between gap-2">
      <h3 class="text-lg font-extrabold uppercase">{% trans "القادمة 3 حجوزات" %}</h3>
      <a href="{% url 'admin:salon_booking_changelist' %}" class="text-primary-700 hover:text-primary-500 transition text-sm">{% trans "عرض الكل" %}</a>
    </div>
    <div class="table-responsive">
      <table class="min-w-full text-sm">
        <thead class="sticky top-0 table-head-bg">
          <tr>
            <th class="text-start p-3">{% trans "العميل" %}</th>
            <th class="text-start p-3">{% trans "الخدمة" %}</th>
            <th class="text-start p-3">{% trans "الموظف" %}</th>
            <th class="text-start p-3">{% trans "الوقت" %}</th>
            <th class="text-start p-3">{% trans "الحالة" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for b in todays_bookings %}
            <tr class="border-b hover:opacity-95 transition even:table-row-alt">
              <td class="p-3">{{ b.customer.name }}</td>
              <td class="p-3">{{ b.service.name }}</td>
              <td class="p-3">{{ b.staff.name|default:"—" }}</td>
              <td class="p-3">{{ b.booking_time }}</td>
              <td class="p-3"><span class="admin-chip">{{ b.get_status_display }}</span></td>
            </tr>
          {% empty %}
            <tr><td class="p-3 text-primary-700/70" colspan="5">{% trans "لا توجد حجوزات" %}</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Service Analytics -->
  <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
    <div class="admin-card p-5 rounded-xl">
      <h3 class="text-lg font-extrabold uppercase mb-3">{% trans "أكثر الخدمات طلبًا" %}</h3>
      <div class="space-y-3">
        {% for service in stats.popular_services %}
        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
          <div class="flex items-center gap-3">
            <span class="w-8 h-8 bg-primary-600 text-white rounded-full flex items-center justify-center text-sm font-bold">{{ forloop.counter }}</span>
            <div>
              <p class="font-medium text-sm">{{ service.name }}</p>
              <p class="text-xs text-gray-500">{{ service.category.name }}</p>
            </div>
          </div>
          <div class="text-right">
            <p class="font-bold text-sm">{{ service.booking_count }}</p>
            <p class="text-xs text-gray-500">حجز</p>
          </div>
        </div>
        {% empty %}
        <p class="text-sm text-gray-500 text-center py-4">{% trans "لا توجد بيانات" %}</p>
        {% endfor %}
      </div>
    </div>

    <div class="admin-card p-5 rounded-xl">
      <h3 class="text-lg font-extrabold uppercase mb-3">{% trans "الإيرادات حسب الخدمة" %}</h3>
      <div class="mt-4" style="height: 300px;">
        <canvas id="serviceRevenueChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Additional Charts -->
  <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
    <div class="admin-card p-5 rounded-xl">
      <h3 class="text-lg font-extrabold uppercase mb-3">{% trans "توزيع الحجوزات حسب الساعات" %}</h3>
      <div class="mt-4" style="height: 300px;">
        <canvas id="hourlyChart"></canvas>
      </div>
    </div>

    <div class="admin-card p-5 rounded-xl">
      <h3 class="text-lg font-extrabold uppercase mb-3">{% trans "الإيرادات الشهرية" %}</h3>
      <div class="mt-4" style="height: 300px;">
        <canvas id="monthlyRevenueChart"></canvas>
      </div>
    </div>
  </div>
<!-- payments  -->
<div class="admin-card p-5 rounded-xl mt-6">
  <h3 class="text-lg font-extrabold uppercase mb-3">  آخر المدفوعات</h3>
  <div class="table-responsive">
    <table class="min-w-full text-sm">
      <thead class="sticky top-0 table-head-bg">
        <tr>
          <th class="p-3 text-start">رقم الدفع</th>
          <th class="p-3 text-start">العميل</th>
          <th class="p-3 text-start">المبلغ</th>
          <th class="p-3 text-start">طريقة الدفع</th>
          <th class="p-3 text-start">الحالة</th>
          <th class="p-3 text-start">التاريخ</th>
        </tr>
      </thead>
      <tbody>
        {% for payment in latest_payments %}
          <tr class="border-b hover:opacity-95 transition even:table-row-alt">
            <td class="p-3">{{ payment.id }}</td>
            <td class="p-3">{{ payment.customer_name }}</td>
            <td class="p-3">{{ payment.amount }} SAR</td>
            <td class="p-3">{{ payment.payment_method }}</td>
            <td class="p-3">{{ payment.status }}</td>
            <td class="p-3">{{ payment.created_at }}</td>
          </tr>
        {% empty %}
          <tr>
            <td class="p-3 text-primary-700/70" colspan="6">لا توجد مدفوعات</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>






  <!-- Heatmap -->
  <div class="admin-card p-5 rounded-xl">
    <h3 class="text-lg font-extrabold uppercase mb-3">{% trans "خريطة الحرارة - آخر 7 أيام" %}</h3>
    <div class="grid grid-cols-7 gap-2 mt-4">
      {% for day in charts.heatmap_data %}
      <div class="text-center">
        <div class="text-xs text-gray-500 mb-1">{{ day.date }}</div>
        <div class="w-full h-16 rounded-lg flex flex-col items-center justify-center text-xs font-medium
          {% if day.bookings == 0 %}bg-gray-100 text-gray-400
          {% elif day.bookings == 1 %}bg-yellow-200 text-yellow-800
          {% elif day.bookings == 2 %}bg-orange-300 text-orange-800
          {% else %}bg-red-400 text-red-800{% endif %}">
          <span>{{ day.bookings }}</span>
          <span>حجز</span>
        </div>
        <div class="text-xs text-gray-500 mt-1">{{ day.revenue }} ر.س</div>
      </div>
      {% endfor %}
    </div>
  </div>

  <div class="grid grid-cols-1 xl:grid-cols-3 gap-4">
    <div class="admin-card p-5 rounded-xl xl:col-span-2">
      <h3 class="text-lg font-extrabold uppercase mb-3">{% trans "آخر الإجراءات" %}</h3>
      <ol class="relative ps-6">
        {% for item in recent_activity %}
          <li class="mb-4">
            <div class="relative">
              <span class="absolute -start-6 top-2 w-3 h-3 rounded-full" style="background:#B89F67"></span>
              <div class="flex flex-col gap-1">
                <div class="flex flex-wrap items-center gap-2">
                  <span class="font-semibold text-sm" style="color:#000">{{ item.title }}</span>
                  <span class="text-xs opacity-70" style="color:#000">{{ item.timestamp }}</span>
                </div>
                <p class="text-sm opacity-85" style="color:#000">{{ item.subtitle }}</p>
              </div>
            </div>
          </li>
        {% empty %}
          <li class="text-sm opacity-70" style="color:#000">{% trans "لا توجد إجراءات حديثة" %}</li>
        {% endfor %}
      </ol>
    </div>

    <div class="admin-card p-5 rounded-xl">
      <h3 class="text-lg font-extrabold uppercase mb-3">{% trans "الفلاتر السريعة" %}</h3>
      <div class="flex flex-wrap gap-2">
        <a href="{% url 'admin:salon_service_changelist' %}?is_active__exact=1" class="admin-chip hover:shadow-glam transition">{% trans "نشط" %}</a>
        <a href="{% url 'admin:salon_service_changelist' %}?is_featured__exact=1" class="admin-chip hover:shadow-glam transition">{% trans "مميز" %}</a>
        <a href="{% url 'admin:salon_service_changelist' %}?category__id__exact={{ featured_category_id|default:'' }}" class="admin-chip hover:shadow-glam transition">{% trans "حسب الفئة" %}</a>
        <a href="{% url 'admin:salon_booking_changelist' %}?status__exact=confirmed" class="admin-chip hover:shadow-glam transition">{% trans "حجوزات مؤكدة" %}</a>
      </div>
      <p class="text-xs text-primary-700/70 mt-3">{% trans "يمكنك تعديل الخيارات من الإعدادات" %}</p>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Main Dashboard Chart
  const canvas = document.getElementById('dashboardChart');
  if (canvas) {
    const labels = {{ charts.labels|default:"[]"|safe }};
    const bookings = {{ charts.bookings|default:"[]"|safe }};
    const revenue = {{ charts.revenue|default:"[]"|safe }};

    new Chart(canvas, {
      type: 'line',
      data: {
        labels,
        datasets: [
          { label: '{% trans "الحجوزات" %}', data: bookings, borderColor: '#000000', backgroundColor: 'rgba(0,0,0,0.08)', tension: 0.35, borderWidth: 2, fill: true },
          { label: '{% trans "الإيرادات (SAR)" %}', data: revenue, borderColor: '#B89F67', backgroundColor: 'rgba(184,159,103,0.25)', tension: 0.35, borderWidth: 2, fill: true, yAxisID: 'y1' },
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.06)' }, ticks: { color: '#000000' } },
          y1: { beginAtZero: true, position: 'right', grid: { drawOnChartArea: false }, ticks: { color: '#000000' } },
          x: { grid: { display: false }, ticks: { color: '#000000' } }
        },
        plugins: { legend: { display: true, labels: { color: '#000000' } }, tooltip: { mode: 'index', intersect: false } },
        interaction: { mode: 'index', intersect: false }
      }
    });
  }

  // Service Revenue Chart
  const serviceCanvas = document.getElementById('serviceRevenueChart');
  if (serviceCanvas) {
    const serviceLabels = {{ charts.service_labels|default:"[]"|safe }};
    const serviceData = {{ charts.service_distribution|default:"[]"|safe }};
    
    new Chart(serviceCanvas, {
      type: 'doughnut',
      data: {
        labels: serviceLabels,
        datasets: [{
          data: serviceData,
          backgroundColor: [
            '#B89F67', '#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c'
          ],
          borderWidth: 2,
          borderColor: '#ffffff'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'bottom', labels: { color: '#000000', padding: 20 } },
          tooltip: { callbacks: { label: function(context) { return context.label + ': ' + context.parsed + ' حجز'; } } }
        }
      }
    });
  }

  // Hourly Distribution Chart
  const hourlyCanvas = document.getElementById('hourlyChart');
  if (hourlyCanvas) {
    const hourlyLabels = {{ charts.hourly_labels|default:"[]"|safe }};
    const hourlyData = {{ charts.hourly_values|default:"[]"|safe }};
    
    new Chart(hourlyCanvas, {
      type: 'bar',
      data: {
        labels: hourlyLabels.map(h => h + ':00'),
        datasets: [{
          label: '{% trans "عدد الحجوزات" %}',
          data: hourlyData,
          backgroundColor: 'rgba(184,159,103,0.8)',
          borderColor: '#B89F67',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.06)' }, ticks: { color: '#000000' } },
          x: { grid: { display: false }, ticks: { color: '#000000' } }
        },
        plugins: { legend: { display: false } }
      }
    });
  }

  // Monthly Revenue Chart
  const monthlyCanvas = document.getElementById('monthlyRevenueChart');
  if (monthlyCanvas) {
    const monthlyLabels = {{ charts.monthly_labels|default:"[]"|safe }};
    const monthlyData = {{ charts.monthly_revenue|default:"[]"|safe }};
    
    new Chart(monthlyCanvas, {
      type: 'bar',
      data: {
        labels: monthlyLabels,
        datasets: [{
          label: '{% trans "الإيرادات (SAR)" %}',
          data: monthlyData,
          backgroundColor: 'rgba(52,152,219,0.8)',
          borderColor: '#3498db',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.06)' }, ticks: { color: '#000000' } },
          x: { grid: { display: false }, ticks: { color: '#000000' } }
        },
        plugins: { legend: { display: false } }
      }
    });
  }
});
</script>
{% endblock %}


